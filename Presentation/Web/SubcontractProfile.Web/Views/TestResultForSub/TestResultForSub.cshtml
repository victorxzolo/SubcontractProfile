

@using Microsoft.AspNetCore.Mvc.Localization

@inject IViewLocalizer Localizer


@{
    ViewData["Title"] = "Test Result";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="pageID" style="display:none;">TestResultForSub</div>

<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">

    <div class="skills layout-spacing ">
        <div class="widget-content widget-content-area">
            <h3 class="">@Localizer["TestResult"]</h3>

            <div class="widget-content1">

                <div class="form-row mb-4">


                    <div class="form-group col-md-6">
                        <label for="inputEmail4">@Localizer["TrainingDateFrom"]</label>
                        <div class='input-group date p-0' id="training_date_fr">
                            <input type='text' class="form-control" id="inputTraining_date_fr" />
                            <div class="input-group-append input-group-addon">
                                <span class="input-group-text px-4">
                                    <i class="fa fa-calendar"></i>
                                </span>
                            </div>

                        </div>

                    </div>
                    <div class="form-group col-md-6">
                        <label for="inputPassword4">@Localizer["TrainingDateTo"]</label>
                        <div class='input-group date p-0' id="training_date_to">
                            <input type='text' class="form-control" id="inputTraining_date_to" />
                            <div class="input-group-append input-group-addon">
                                <span class="input-group-text px-4">
                                    <i class="fa fa-calendar"></i>
                                </span>
                            </div>

                        </div>
                    </div>

                    <div class="form-group col-md-6">
                        <label for="inputEmail4">@Localizer["TestDateFrom"]</label>
                        <div class='input-group date p-0' id="test_date_fr">
                            <input type='text' class="form-control" id="inputTest_date_fr" />
                            <div class="input-group-append input-group-addon">
                                <span class="input-group-text px-4">
                                    <i class="fa fa-calendar"></i>
                                </span>
                            </div>

                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="inputPassword4">@Localizer["TestDateTo"]</label>
                        <div class='input-group date p-0' id="test_date_to">
                            <input type='text' class="form-control" id="inputTest_date_to" />
                            <div class="input-group-append input-group-addon">
                                <span class="input-group-text px-4">
                                    <i class="fa fa-calendar"></i>
                                </span>
                            </div>

                        </div>
                    </div>

                    <div class="form-group col-md-6">
                        <label for="inputStatus">@Localizer["Status"]</label>
                        <select id="inputStatus" class="form-control" data-live-search="true"></select>
                    </div>

                </div>

                <div style="text-align:center">

                    <button id="btnMainClear" type="button" class="btn btn-dark mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg> @Localizer["Reset"]
                    </button>
                    <button id="btnSearch" type="button" class="btn btn-success mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>  @Localizer["Search"]
                    </button>

                </div>


            </div>


            <br />
            <div class="widget-heading">
                <h3 class="">@Localizer["SearchResult"]</h3>

            </div>

            <div class="table-responsive mb-4 mt-4">
                <table id="tbSearchResult" class="table table-hover" style="width:100%">
                    <thead>
                        <tr>
                            <th width="10%">@Localizer["Action"]</th>
                            <th>@Localizer["Status"]</th>
                            <th>@Localizer["CompanyName"]</th>
                            <th>@Localizer["TaxId"]</th>
                            <th>@Localizer["TrainingDate"]</th>
                            <th>@Localizer["TestDate"]</th>
                        </tr>
                    </thead>
                </table>
            </div>

        </div>
    </div>

</div>


@section modalpanel {

    <div id="AdjustReqTraining" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="hTitleEdit" class="modal-title">@Localizer["TestResult"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="frNew" class="needs-validation" novalidate>
                    <div class="modal-body">

                        <div class="container">

                            <div class="row">
                                <div class="col-sm-2">
                                    <label>@Localizer["CompanyName"] :</label>
                                </div>
                                <div class="col-sm-4">
                                    <label id="lblcompname"></label>
                                </div>

                                <div class="col-sm-2">
                                    <label>@Localizer["TaxId"] :</label>
                                </div>
                                <div class="col-sm-4">
                                    <label id="lbltaxid"></label>
                                </div>



                            </div>
                            <div class="row">
                                <div class="col-sm-2">
                                    <label>@Localizer["ContactPhone"] :</label>
                                </div>
                                <div class="col-sm-4">
                                    <label id="lblContactPhone"></label>
                                </div>

                                <div class="col-sm-2">
                                    <label>@Localizer["ContactEmail"] :</label>
                                </div>
                                <div class="col-sm-4">
                                    <label id="lblContactEmail"></label>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-sm-2">
                                    <label>@Localizer["Course"] :</label>
                                </div>
                                <div class="col-sm-4">
                                    <label id="lblCouse"></label>
                                </div>

                                <div class="col-sm-2">
                                    <label>@Localizer["CoursePrice"] :</label>
                                </div>
                                <div class="col-sm-4">
                                    <label id="lblCousePrice"></label>
                                </div>

                            </div>



                            <br />
                            <h4>@Localizer["TestCandidate"] </h4>
                            <hr>
                            <div class="table-responsive">
                                <table id="tbSearchEngineer" style="width:100%" class="table table-bordered table-hover table-striped table-checkable table-highlight-head mb-4">
                                    <thead>
                                        <tr>
                                            <th width="0%"></th>
                                            <th width="0%"></th>
                                            <th width="0%"></th>
                                            <th width="15%">@Localizer["LocationName"]</th>
                                            <th width="15%">@Localizer["TeamName"]</th>
                                            <th width="15%">@Localizer["Engineer"]</th>
                                            <th width="15%">@Localizer["TestStatus"]</th>
                                            <th width="10%">@Localizer["Grade"]</th>
                                            <th width="15%">@Localizer["TestReason"]</th>
                                            <th width="15%">@Localizer["TestRemark"]</th>

                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            <br />
                            <h4>@Localizer["ForStaffAIS"] </h4>
                            <hr>
                            <div class="row">

                                <div class="col-sm-2">
                                    <label>@Localizer["TestDate"] : </label>
                                </div>
                                <div class="col-sm-4">
                                    <div class='input-group date p-0' id="test_date">
                                        <label id="inputTest_date"></label>

                                    </div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-sm-2">
                                    <label>@Localizer["Remark"] :</label>
                                </div>
                                <div class="col-sm-10">

                                    <label id="txtRemark"></label>
                                </div>
                            </div>


                            <input type="hidden" id="hdTrainingId" />
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-power"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line x1="12" y1="2" x2="12" y2="12"></line></svg>
                            @Localizer["Close"]
                        </button>
                        @*<button id="btnSave" type="submit" class="btn btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-save"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                                Save
                            </button>*@
                    </div>
                </form>
            </div>
        </div>
    </div>

}


@section scripts {
    <script type="text/javascript">

        var oTable;
        $(document).ready(function () {




            GetDropDownByNameTrainigStatus();

            $('#training_date_fr').datetimepicker({
                format: "DD/MM/YYYY",
                showClear: true,
                showClose: true,
                icons: {
                    time: 'fa fa-clock-o',
                    date: 'fa fa-calendar',
                    up: 'fa fa-chevron-up',
                    down: 'fa fa-chevron-down',
                    previous: 'fa fa-chevron-left',
                    next: 'fa fa-chevron-right',
                    today: 'icon-screenshot',
                    clear: 'fa fa-trash',
                    close: 'fa fa-time'
                }
            });

            $('#training_date_to').datetimepicker({
                format: "DD/MM/YYYY",
                showClear: true,
                showClose: true,
                icons: {
                    time: 'fa fa-clock-o',
                    date: 'fa fa-calendar',
                    up: 'fa fa-chevron-up',
                    down: 'fa fa-chevron-down',
                    previous: 'fa fa-chevron-left',
                    next: 'fa fa-chevron-right',
                    today: 'icon-screenshot',
                    clear: 'fa fa-trash',
                    close: 'fa fa-time'
                }
            });

            $('#test_date_fr').datetimepicker({
                format: "DD/MM/YYYY",
                showClear: true,
                showClose: true,
                icons: {
                    time: 'fa fa-clock-o',
                    date: 'fa fa-calendar',
                    up: 'fa fa-chevron-up',
                    down: 'fa fa-chevron-down',
                    previous: 'fa fa-chevron-left',
                    next: 'fa fa-chevron-right',
                    today: 'icon-screenshot',
                    clear: 'fa fa-trash',
                    close: 'fa fa-time'
                }
            });

            $('#test_date_to').datetimepicker({
                format: "DD/MM/YYYY",
                showClear: true,
                showClose: true,
                icons: {
                    time: 'fa fa-clock-o',
                    date: 'fa fa-calendar',
                    up: 'fa fa-chevron-up',
                    down: 'fa fa-chevron-down',
                    previous: 'fa fa-chevron-left',
                    next: 'fa fa-chevron-right',
                    today: 'icon-screenshot',
                    clear: 'fa fa-trash',
                    close: 'fa fa-time'
                }
            });

            clearMainData();

            inittbSearchResult();

            $("#btnSearch").click(function (e) {
                inittbSearchResult();
            });

            $("#btnMainClear").click(function (e) {
                 clearMainData();
            });

        });

         function GetDropDownByNameTrainigStatus() {

                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetDropDownList", "RequestTraining")',
                        data: { '_ddlType': 'training_status' },
                        dataType: 'json',
                        success: function (data) {

                            $("#inputStatus").empty();
                          //  $("#inputStatus").append('<option value="-1">--Select All--</option>');
                            $.each(data, function (id, result) {
                                if (result.dropdown_value == "T" ) {
                                    $("#inputStatus").append('<option value="' + result.dropdown_value + '">' + result.dropdown_text + '</option>');
                                }
                                });

                            },
                            failure: function () {
                                $("#inputStatus").empty();
                                $("#inputStatus").append('<option value="-1">--@Localizer["SelectAll"]--</option>');
                            }
                        });
                        }

        'use strict';
        window.addEventListener('load', function () {
            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.getElementsByClassName('needs-validation');
            // Loop over them and prevent submission
            var validation = Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', function (event) {

                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();

                    } else {
                       // onUpdate();

                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);


        function clearMainData() {

            $("#inputTraining_date_fr").val('');
            $("#inputTraining_date_to").val('');
            $("#inputTest_date_fr").val('');
            $("#inputTest_date_to").val('');
            $("#inputStatus").val('-1');

        }

         function inittbSearchResult() {

              var oTable = $('#tbSearchResult').DataTable({
                processing: true, // for show progress bar
                serverSide: true, // for process server side
                filter: false, // this is for disable filter (search box)
                orderMulti: false, // for disable multiple column at once
                pageLength: 10,
                order: [],
                autoWidth: false,
                searching: false,
                destroy: true,
                lengthChange: false,
                "oLanguage": {
                    "oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
                    "sInfo": "Showing page _PAGE_ of _PAGES_",
                    "sSearch": false,
                    "sLengthMenu": "Results :  _MENU_",
                },
                 "scrollX": false,
                  "language": {
                  "zeroRecords": "No data found.",
                   "decimal": ",",
                  "thousands": "."
                    },
                    ajax: {
                        url: '@Url.Action("SearchForSub", "TestResultForSub")',
                        type: "POST",
                        datatype: "JSON",
                        //dataSrc:"",
                        data: function (d) {

                            d.training_date_fr = $("#inputTraining_date_fr").val(),
                            d.training_date_to = $("#inputTraining_date_to").val(),
                            d.test_date_fr = $("#inputTest_date_fr").val(),
                            d.test_date_to = $("#inputTest_date_to").val(),
                            d.Status = $("select[id$=inputStatus]").val()
                        }
                  },
                    columns: [
                        {
                            data: null,width:'10%', orderable: false, render: function (data, type, row) {
                                return "  <ul class='table-controls'><li> <a href='#' onclick=openModal('edit','" + row.TrainingId + "');return false;  data-toggle='modal' data-target='.bd-addedit-modal-xl' data-original-title='แก้ไข'><svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-edit'><path d='M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7'></path><path d='M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z'></path></svg></a></li> </ul> ";
                            }
                        },
                        {
                            data: null, render: function (data, type, row) {
                                return "<span class='badge outline-badge-secondary shadow-none'>" + row.Status + "</span>";
                            }

                        },
                        { "data": "CompanyNameTh"  },
                        { "data": "TaxId"},
                        {
                         "data": "BookingDate", "render": function (data, type, row) {
                                if (type === "sort" || type === "type") {
                                    return data;
                                }
                                if (moment(data).format("DD/MM/YYYY") != 'Invalid date') {
                                    return moment(data).format("DD/MM/YYYY");
                                }
                                else {
                                    return data;
                                }

                            }
                        },
                        {
                            "data": "TestDate", "render": function (data, type, row) {
                                if (type === "sort" || type === "type") {
                                    return data;
                                }
                                if (moment(data).format("DD/MM/YYYY") != 'Invalid date') {
                                    return moment(data).format("DD/MM/YYYY");
                                }
                                else {
                                    return data;
                                }
                            }
                        }



                ],
                  "order": [[0, "desc"]],

                "stripeClasses": [],
                drawCallback: function () { $('.dataTables_paginate > .pagination').addClass(' pagination-style-13 pagination-bordered mb-5'); }

                });

        }




        function openModal(mode, trainingId) {
            $("#frNew")[0].reset();
            $('#AdjustReqTraining').modal('show');
            $('input[name="optionsRadios"][value="01"]').attr('checked', true);
            callTrainingDetail(trainingId);


        }

          function callTrainingDetail(trainingID) {

                                 $.ajax({
                                      url: '@Url.Action("GetTraining", "RequestTraining")',
                                      type: 'POST',
                                      data: {
                                          'TrainingID': trainingID,

                                      },
                                      dataType: "json",
                                     success: function (result) {

                                         if (result != null) {

                                             $('#lblcompname').html(result.CompanyNameTh);
                                             $('#lbltaxid').html(result.TaxId);
                                             $('#lblContactPhone').html(result.ContractPhone);
                                             $('#lblContactEmail').html(result.ContractEmail);
                                             $('#lblCouse').html(result.CourseName);
                                             $('#lblCousePrice').html(FormatNumber(result.CoursePrice));

                                             $('#inputTest_date').html(result.TestDateStr);

                                             $('#hdTrainingId').val(result.TrainingId);
                                             $('#txtRemark').html(result.RemarkForTest);

                                             inittbEngineer(result.TrainingId);

                                         }
                                         else {

                                         }


                                      },
                                      failure: function () {

                                      }
                                 });


                        }

            function inittbEngineer(Trainingid) {
                           var i = 0;
                            oTableEngineer = $('#tbSearchEngineer').DataTable({
                                processing: true, // for show progress bar
                                serverSide: true, // for process server side
                                filter: false, // this is for disable filter (search box)
                                orderMulti: false, // for disable multiple column at once
                                pageLength: 10,
                                order: [],
                                autoWidth: true,
                                searching: false,
                                destroy: true,
                                lengthChange: false,
                                "oLanguage": {
                                    "oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
                                    "sInfo": "Showing page _PAGE_ of _PAGES_",
                                    "sSearch": false,
                                    "sLengthMenu": "Results :  _MENU_",
                                },
                                "scrollX": false,
                                "language": {
                                    "zeroRecords": "No data found.",
                                    "decimal": ",",
                                    "thousands": "."
                                },
                                ajax: {
                                    url: '@Url.Action("SearchEngineer", "RequestTraining")',
                                    type: "POST",
                                    datatype: "JSON",
                                    //dataSrc:"",
                                    data: function (d) {
                                        d.Trainingid = Trainingid
                                    }
                                },
                                columns: [
                                    { data: "LocationId", "visible": false },
                                    { data: "TeamId", "visible": false },
                                    { data: "EngineerId", "visible": false },
                                    { data: "LocationNameTh"},
                                    { data: "TeamNameTh"},
                                    { data: "StaffNameTh" },
                                    { data: "TestStatusName" },
                                    { data: "SkillLevel" },
                                    { data: "TestReason" },
                                    { data: "TestRemark" }



                                ],
                                "order": [[0, "desc"]],
                                "stripeClasses": [],
                                "initComplete": function (settings, json) {

                                },
                                drawCallback: function () { $('.dataTables_paginate > .pagination').addClass(' pagination-style-13 pagination-bordered mb-5'); }

                            });


                        }

        function FormatNumber(number, numberOfDigits) {
            try {
                return new Intl.NumberFormat('en-US').format(parseFloat(number).toFixed(2));
            } catch (error) {
                return 0;
            }
        }

    </script>
}
