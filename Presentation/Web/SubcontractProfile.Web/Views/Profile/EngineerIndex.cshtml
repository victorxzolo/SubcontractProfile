@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
    <div class="widget widget-chart-one">
        <div class="widget-heading">
            <h5 class="">Engineer</h5>

        </div>
        <div class="widget-content ">

            <div class="form-row mb-4">
                <div class="form-group col-md-12">
                    <label for="inputEmail4">ประเภทผู้สมัคร</label> <br />
                    <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" id="customRadioInline1" name="customRadioInline1" class="custom-control-input" checked="checked">
                        <label class="custom-control-label" for="customRadioInline1">New Subcontract</label>
                    </div>
                    <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" id="customRadioInline2" name="customRadioInline1" class="custom-control-input">
                        <label class="custom-control-label" for="customRadioInline2">Dealer</label>
                    </div>
                </div>

                <div class="form-group col-md-6">
                    <label for="inputEmail4">Location Code</label>
                    <select class="placeholder js-states form-control" id="ddlLocationCode">
                        <option>Choose...</option>
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="inputPassword4">Team Name</label>
                    <select class="placeholder js-states form-control" id="ddlTeamName">
                        <option>Choose...</option>
                    </select>
                </div>

                <div class="form-group col-md-6">
                    <label for="inputEmail4">Staff Name</label>
                    <input type="text" class="form-control" id="txtStaffName" placeholder="Staff Name">
                </div>
                <div class="form-group col-md-6">
                    <label for="inputPassword4">Citizen ID</label>
                    <input type="text" class="form-control" id="txtCitizenID" placeholder="Citizen ID">
                </div>

                <div class="form-group col-md-6">
                    <label for="inputPassword4">Position</label>
                    <select class="placeholder js-states form-control" id="ddlPosition">
                        <option>Choose...</option>
                    </select>
                </div>

            </div>


            <div style="text-align:center">

                <button class="btn btn-dark mb-2" type="button" id="btnclear" onclick="clearData()">
                    <i class="fa fa-refresh icon"></i><span>ล้างข้อมูล</span>
                </button>
                <button class="btn btn-success mb-2" type="button" id="btnSearch" onclick="SearchEngineer()">
                    <i class="fa fa-search icon"></i><span>ค้นหาข้อมูล</span>
                </button>

            </div>
            <div style="text-align:right">

                <button class="btn btn-success mb-2" type="button" id="btnNew" onclick="addNew()">
                    <i class="fa fa-search icon"></i><span>New Engineer</span>
                </button>

            </div>

        </div>


        <br />
        <div class="widget-heading">
            <h5 class="">ผลการค้นหา</h5>
        </div>
        @*</div>
            <div class="col-md-12 text-right mb-1">
                <button id="add-work-platforms" class="btn btn-success mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>เพิ่ม</button>

            </div>*@


        <div class="table-responsive">
            <table class="table table-bordered table-hover table-striped table-checkable table-highlight-head mb-4" id="SearchEngineerResult">
                <thead class="thead-light">
                    <tr>
                        @*<th class="checkbox-column">
                                <label class="new-control new-checkbox checkbox-primary" style="height: 18px; margin: 0 auto;">
                                    <input type="checkbox" class="new-control-input todochkbox" id="selectAll">
                                    <span class="new-control-indicator"></span>
                                </label>
                            </th>*@
                        <th>EngineerID</th>
                        @*<th>ประเภทผู้สมัคร</th>*@
                        <th>Staff Code</th>
                        <th>Staff Name</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>



@section scripts
{

    <script type="text/javascript">


        //$('#regisdatefrom').datepicker({
        //    format: 'dd/mm/yyyy',
        //    daysOfWeekHighlighted: "6,0",
        //    autoclose: true,
        //    todayHighlight: true,
        //    clearBtn: true,
        //});
        //$('#regisdateto').datepicker({
        //    format: 'dd/mm/yyyy',
        //    daysOfWeekHighlighted: "6,0",
        //    autoclose: true,
        //    todayHighlight: true,
        //    clearBtn: true,

        //});

        function clearData() {
            $("#txtStaffName").val("");
            $("#txtCitizenID").val("");
            //$("#txtCompanyNameT").val("");
            //$("#txtCompanyNameE").val("");
            //$("#txtCompanyAlias").val("");
            //$("#txtCompanyCode").val("");
            //$("#ddldistribution").val();
            //$("#ddlchannelsalegroup").val();
            var table = $('#SearchEngineerResult').DataTable();
            table.destroy();
        }

        function getAllEngineer() {
            var groupId = '0';
            var tbCompany = $('#SearchEngineerResult').DataTable({
                ajax: {

                    type: "POST",
                    dataType: 'JSON',
                    url: "/Profile/GetEngineer",
                    data: { 'EngineerId': groupId },
                    dataSrc: function (data) {
                        //var val = []
                        //val = ConcatstrAddress(data.data);
                        //data.data = val;
                        return data.data;
                    },
                    error: function (xhr, status, error) {
                        //Loading(0);
                        //clearForEdit();
                        console.log(status);
                        //showFeedback("error", xhr.responseText, "System Information",
                            //"<button type='button' class='btn-border btn-black' data-dismiss='modal' id='btncancelpopup'><i class='fa fa-ban icon'></i><span>Cancel</span></button >");
                    }
                },
                columns: [
                    { "data": "EngineerId", "visible": false  },
                    //{ "data": "vendorCode" },
                    { "data": "StaffCode" },
                    { "data": "StaffName" },
                    {
                        "data": null,
                        orderable: false,
                        "defaultContent": "<button id='btnEdit' class='btn-border btn-green edit_btn'><i class='fa fa-edit icon'></i><span>แก้ไข</span></button><button id='btnDel' class='btn-border btn-black delete_btn'><i class='fa fa-trash icon'></i><span>ลบ</span></button>"

                    }
                ],
            });

            $('#SearchEngineerResult tbody').on('click', 'button', function () {
                var table = $('#SearchEngineerResult').DataTable();
                var id = this.id;
                var data = table.row($(this).parents('tr')).data();
                //var data = table.row(this).data();
                var val = data['EngineerId'];
                if (id == 'btnEdit') {
                    localStorage.clear();
                    var getID = [{
                        engineerID: val
                    }];
                    localStorage.setItem('enID', JSON.stringify(getID));
                    location.href = '@Url.Action("_PartialEngineer", "Profile")';
                }
                if (id == 'btnDel')
                    DelEngineer(val);

            });
        }


        function SearchEngineer() {
            var table = $('#SearchEngineerResult').DataTable();
            table.destroy();
            if ($("#txtStaffName").val() !== "" || $("#txtCitizenID").val() !== "") {

                var data = {
                    "ProfileType": " ",//$("#chktype").val(),
                    "LocationCode": " ", //$("#ddlLocationCode").val(),
                    "VendorCode": " ",//$("#txtVenderCode").val(),
                    "CompanyNameTh": $("#txtCompanyNameT").val(),
                    "CompanyNameEn": $("#txtCompanyNameE").val(),
                    "CompanyAlias": $("#txtCompanyAlias").val(),
                    "CompanyCode": $("#txtCompanyCode").val(),
                    "DistibutionCchannel": " ",//$("#ddldistribution").val(),
                    "ChannelGroup": " "//$("#ddlchannelsalegroup").val()
                };

                var tbCompany = $('#SearchEngineerResult').DataTable({
                    ajax: {

                        type: "POST",
                        //dataType: 'JSON',
                        url: "/Profile/SearchEngineer",
                        data: { Engineer: data },
                        dataSrc: function (data) {
                            //var val = []
                            //val = ConcatstrAddress(data.data);
                            //data.data = val;
                            return data.data;
                        },
                        error: function (xhr, status, error) {
                            //Loading(0);
                            //clearForEdit();
                            console.log(status);
                            //showFeedback("error", xhr.responseText, "System Information",
                            //"<button type='button' class='btn-border btn-black' data-dismiss='modal' id='btncancelpopup'><i class='fa fa-ban icon'></i><span>Cancel</span></button >");
                        }

                    },
                    columns: [
                        { "data": "EngineerId", "visible": false },
                        //{ "data": "vendorCode" },
                        { "data": "StaffCode" },
                        { "data": "StaffName" },
                        {
                            "data": null,
                            orderable: false,
                            "defaultContent": "<button id='btnEdit' class='btn-border btn-green edit_btn'><i class='fa fa-edit icon'></i><span>แก้ไข</span></button><button id='btnDel' class='btn-border btn-black delete_btn'><i class='fa fa-trash icon'></i><span>ลบ</span></button>"

                        }
                    ],
                });

                $('#SearchEngineerResult tbody').on('click', 'button', function () {
                    var table = $('#SearchEngineerResult').DataTable();
                    var id = this.id;
                    var data = table.row($(this).parents('tr')).data();
                    //var data = table.row(this).data();
                    var val = data['EngineerId'];
                    if (id == 'btnEdit') {
                        localStorage.clear();
                        var getID = [{
                            engineerID: val
                        }];
                        localStorage.setItem('enID', JSON.stringify(getID));
                        location.href = '@Url.Action("_PartialEngineer", "Profile")';
                    }

                    if (id == 'btnDel') {
                        DelEngineer(val);
                    }

            });
            }
            else {
                getAllEngineer();
            }
        }

        function DelEngineer(enId) {
            //var comId = 'a8bf8003-22dc-4e22-add6-7564e41f312c';
            $.ajax({
                url: "/Profile/DeleteEngineer",
                dataType: 'JSON',
                data: { 'EngineerId': enId },
                type: 'POST',
                success: function (result) {
                    //alert("success");
                },
                error: function (result) {
                    //alert("error");
                }
            });
        }

        function addNew() {
            localStorage.clear();
            var getID = [{
                engineerID: '0'
            }];
            localStorage.setItem('enID', JSON.stringify(getID));
            location.href = '@Url.Action("_PartialEngineer", "Profile")';
        }
    </script>

}